<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>View Note</title>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#0b0d12;
  color:#e5e7eb;
  font-family:system-ui,Arial;
}
.wrap{max-width:760px;margin:16px auto;padding:14px}
.card{
  background:#111827;
  border-radius:10px;
  padding:16px;
}
h1{margin:0 0 6px;font-size:22px}
.meta{display:flex;gap:12px;font-size:13px;color:#9ca3af;margin-bottom:14px}
.content,.content *{pointer-events:auto}
.content img{max-width:100%;height:auto;border-radius:8px}
.share{display:flex;gap:10px;margin-top:16px}
.share button{flex:1;padding:10px;border:0;border-radius:8px;background:#1f2937;color:#fff}
.lock{text-align:center;padding:30px}
.lock input{width:100%;padding:10px;border-radius:8px;border:0;margin:10px 0}
.lock button{padding:10px 16px;border:0;border-radius:8px;background:#2563eb;color:#fff}
</style>
</head>
<body>

<div class="wrap">
  <div class="card" id="app" style="display:none">
    <h1 id="title"></h1>
    <div class="meta">
      <span id="time"></span>
      <span>Views: <b id="views">0</b></span>
      <span>Online: <b id="online">0</b></span>
    </div>
    <div id="content" class="content"></div>

    <div class="share">
      <button onclick="wa()">WhatsApp</button>
      <button onclick="tg()">Telegram</button>
      <button onclick="copy()">Salin</button>
    </div>
  </div>

  <div class="card lock" id="lock" style="display:none">
    <h2>Private Note</h2>
    <input id="pass" type="password" placeholder="Password">
    <button onclick="unlock()">Buka</button>
  </div>
</div>

<!-- FIREBASE COMPAT -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyC4KJsPLfoEiZSKQUZHrGzZh6-Fv_0Q7P0",
  authDomain: "views-counter-610fa.firebaseapp.com",
  databaseURL: "https://views-counter-610fa-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "views-counter-610fa",
  storageBucket: "views-counter-610fa.firebasestorage.app",
  messagingSenderId: "998762153750",
  appId: "1:998762153750:web:7113cd0bba422204fa7237"
});

const db=firebase.database();
const id=new URLSearchParams(location.search).get('id');

db.ref('notes/'+id).once('value').then(s=>{
  if(!s.exists()){document.body.innerHTML='NOT FOUND';return;}
  const n=s.val();

  if(n.visibility==='private'){
    lock.style.display='block';
    window.unlock=()=>{
      if(pass.value===n.password) show(n);
      else alert('Password salah');
    }
  }else show(n);
});

function show(n){
  lock.style.display='none';
  app.style.display='block';
  title.textContent=n.title;
  time.textContent=n.time;
  content.innerHTML=n.content;
  viewsCount();
  onlineCount();
}

function viewsCount(){
  const r=db.ref('views/'+id);
  r.transaction(v=>(v||0)+1);
  r.on('value',s=>views.textContent=s.val()||0);
}
function onlineCount(){
  const u=db.ref('online/'+id+'/'+Math.random().toString(36).slice(2));
  u.set(1);u.onDisconnect().remove();
  db.ref('online/'+id).on('value',s=>{
    online.textContent=s.exists()?Object.keys(s.val()).length:0;
  });
}

function copy(){navigator.clipboard.writeText(location.href);alert('Disalin')}
function wa(){open('https://wa.me/?text='+encodeURIComponent(location.href))}
function tg(){open('https://t.me/share/url?url='+encodeURIComponent(location.href))}
</script>

</body>
</html>
