<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Stream</title>

<style>
body{margin:0;background:#05060f;color:#e5e7eb;font-family:system-ui}
.wrap{max-width:720px;margin:auto;padding:14px}
.card{background:#0b1020;border-radius:14px;padding:14px}
.hidden{display:none}
video{width:100%;border-radius:14px;background:#000}
.error{color:#f87171;font-size:14px;margin-top:10px}
</style>
</head>

<body>
<div class="wrap">
  <div id="app" class="card hidden">
    <h3 id="title"></h3>
    <video id="player" controls playsinline></video>
    <div id="err" class="error"></div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
const app = document.getElementById('app');
const title = document.getElementById('title');
const player = document.getElementById('player');
const err = document.getElementById('err');

const id = new URLSearchParams(location.search).get('v');

fetch('/videos')
.then(r=>r.json())
.then(videos=>{
  if(!id || !videos[id]){
    err.textContent = 'Video tidak ditemukan';
    return;
  }

  const v = videos[id];
  title.textContent = v.title;
  app.classList.remove('hidden');

  const src = v.src;

  /* === HLS SUPPORT === */
  if(src.endsWith('.m3u8')){
    if(Hls.isSupported()){
      const hls = new Hls();
      hls.loadSource(src);
      hls.attachMedia(player);
    }else if(player.canPlayType('application/vnd.apple.mpegurl')){
      player.src = src;
    }else{
      err.textContent = 'Browser tidak mendukung HLS';
    }
  }else{
    player.src = src;
  }

  player.load();
});

/* === ERROR HANDLER === */
player.addEventListener('error',()=>{
  err.textContent = 'Video gagal dimuat (format / CORS / server)';
});
</script>
</body>
</html>
