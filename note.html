<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Note Editor</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box}
body{margin:0;background:#f3f4f6;font-family:system-ui,Arial}
.wrap{max-width:720px;margin:12px auto;background:#fff;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.1);overflow:hidden}
.header{padding:12px;border-bottom:1px solid #ddd}
.header input{
  width:100%;
  max-width:100%;
  font-size:16px;
  padding:10px 12px;
  border:1px solid #ccc;
  border-radius:8px;
}

.tabs{display:flex;justify-content:flex-end;border-bottom:1px solid #ddd}
.tab{padding:8px 14px;font-weight:600;background:#e5e7eb;color:#555;cursor:pointer}
.tab.active{background:#fff;color:#dc2626;border-bottom:2px solid #dc2626}

.toolbar{display:flex;gap:6px;padding:8px;border-bottom:1px solid #ddd;overflow-x:auto}
.toolbar button{background:none;border:none;padding:6px;border-radius:6px;cursor:pointer}
.toolbar button:hover{background:#e5e7eb}

.editor{min-height:260px;padding:12px;border:2px solid #2563eb;margin:10px;border-radius:8px;outline:none}
.editor img{max-width:100%;display:block;margin:8px auto;border-radius:6px}

textarea{display:none;width:calc(100% - 20px);height:260px;margin:10px;padding:12px;border-radius:8px}

.footer{display:flex;flex-direction:column;gap:8px;padding:12px;border-top:1px solid #ddd}
.footer select,.footer input,.footer button{
  padding:10px;border-radius:8px;border:1px solid #ccc;font-weight:600;width:100%
}
button.publish{background:#dc2626;color:#fff;border:none;cursor:pointer}

.section{max-width:720px;margin:16px auto;padding:0 6px}
.card{background:#fff;padding:12px;border-radius:10px;margin-bottom:10px;box-shadow:0 2px 8px rgba(0,0,0,.08);display:flex;justify-content:space-between;gap:10px;align-items:center}
.actions{display:flex;gap:6px}
.danger{background:#fee2e2;border-color:#fecaca;color:#991b1b}
small{color:#666}
</style>
</head>

<body>

<div class="wrap">
  <div class="header">
    <input id="title" placeholder="Title">
  </div>

  <div class="tabs">
    <div class="tab active" id="tabEditor">EDITOR</div>
    <div class="tab" id="tabHTML">HTML</div>
  </div>

  <div class="toolbar">
    <button data-cmd="bold">B</button>
    <button data-cmd="justifyLeft">≡</button>
    <button id="imgBtn">IMG</button>
    <button data-cmd="insertUnorderedList">•</button>
    <button data-cmd="undo">↶</button>
  </div>

  <div id="editor" class="editor" contenteditable="true"></div>
  <textarea id="html"></textarea>

  <div class="footer">
    <select id="visibility">
      <option value="public">Public</option>
      <option value="private">Private</option>
    </select>
    <input id="password" placeholder="Password (private)" style="display:none">
    <button class="publish" id="publishBtn">Publish</button>
  </div>
</div>

<div class="section">
  <h3>Hasil Link</h3>
  <div id="links"></div>
</div>

<div class="section">
  <h3>History</h3>
  <div id="history"></div>
</div>

<input type="file" id="imgPick" accept="image/*" hidden>

<script>
const supabase = window.supabase.createClient(
  "https://reglvenhbvmyqujoydil.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJlZ2x2ZW5oYnZteXF1am95ZGlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcyMzc2MDQsImV4cCI6MjA4MjgxMzYwNH0.h-UEIR98TT8TynjraSQi7iwUrnCQ0nLuFJKaHPbOSUc"
);

const editor=document.getElementById('editor');
const html=document.getElementById('html');
const visibility=document.getElementById('visibility');
const password=document.getElementById('password');
const title=document.getElementById('title');
const links=document.getElementById('links');
const historyBox=document.getElementById('history');
const imgPick=document.getElementById('imgPick');

document.querySelectorAll('[data-cmd]').forEach(b=>{
  b.onclick=()=>{editor.focus();document.execCommand(b.dataset.cmd)}
});

document.getElementById('imgBtn').onclick=()=>imgPick.click();
imgPick.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>document.execCommand('insertImage',false,r.result);
  r.readAsDataURL(e.target.files[0]);
};

document.getElementById('tabHTML').onclick=()=>{
  html.value=editor.innerHTML;
  editor.style.display='none';
  html.style.display='block';
};

document.getElementById('tabEditor').onclick=()=>{
  editor.innerHTML=html.value;
  html.style.display='none';
  editor.style.display='block';
};

visibility.onchange=()=>password.style.display=
  visibility.value==='private'?'block':'none';

document.getElementById('publishBtn').onclick=async()=>{
  if(html.style.display==='block') editor.innerHTML=html.value;
  const id=Math.random().toString(36).slice(2,7);

  await supabase.from('notes').insert({
    id,
    title:title.value||'Untitled',
    content:editor.innerHTML,
    time:new Date().toLocaleString(),
    visibility:visibility.value,
    password:password.value||''
  });

  links.innerHTML=`<div class="card"><span>https://narapoi.pages.dev/v/view.html?id=${id}</span></div>`;
  load();
};

async function load(){
  historyBox.innerHTML='';
  const {data}=await supabase.from('notes').select('*').order('time',{ascending:false});
  data.forEach(n=>{
    historyBox.innerHTML+=`
      <div class="card">
        <div><b>${n.title}</b><br><small>${n.time}</small></div>
        <div class="actions">
          <button onclick="window.open('v/view.html?id=${n.id}')">Lihat</button>
        </div>
      </div>`;
  });
}
load();
</script>

</body>
</html>
