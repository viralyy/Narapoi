<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Note Editor</title>

<style>
body{margin:0;background:#f3f4f6;font-family:system-ui}
.wrap{max-width:720px;margin:12px auto;background:#fff;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.1)}
.header{padding:10px;border-bottom:1px solid #ddd}
.header textarea{
  width:100%;
  resize:none;
  font-size:18px;
  padding:8px;
  border:1px solid #ccc;
  border-radius:6px;
}
.tabs{display:flex;justify-content:flex-end;border-bottom:1px solid #ddd}
.tab{padding:8px 14px;cursor:pointer;background:#e5e7eb;font-weight:600}
.tab.active{background:#fff;color:#dc2626;border-bottom:2px solid #dc2626}

.toolbar{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  padding:8px;
  border-bottom:1px solid #ddd
}
.toolbar select,.toolbar button{
  padding:6px;
  border-radius:6px;
  border:1px solid #ccc;
  background:#fff
}
.toolbar button svg{width:18px;height:18px}

.editor{
  min-height:300px;
  padding:12px;
  border:2px solid #2563eb;
  margin:10px;
  border-radius:6px;
  outline:none
}
textarea.html{display:none;width:calc(100% - 20px);height:300px;margin:10px}

.footer{
  display:flex;
  gap:8px;
  justify-content:center;
  padding:10px;
  border-top:1px solid #ddd
}
button.publish{background:#dc2626;color:#fff;border:none;padding:8px 14px;border-radius:6px}

.section{max-width:720px;margin:16px auto}
.card{
  background:#fff;
  padding:10px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
  margin-bottom:8px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:8px
}
.card small{color:#666}
.actions button{margin-left:6px}
</style>
</head>
<body>

<div class="wrap">
  <div class="header">
    <textarea id="title" rows="1" placeholder="Title"></textarea>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="showEditor()">EDITOR</div>
    <div class="tab" onclick="showHTML()">HTML</div>
  </div>

  <div class="toolbar">
    <select onchange="cmd('fontName',this.value)">
      <option value="Arial">Sans</option>
      <option value="Georgia">Serif</option>
      <option value="monospace">Mono</option>
    </select>

    <select onchange="cmd('formatBlock',this.value)">
      <option value="p">Paragraph</option>
      <option value="h1">H1</option>
      <option value="h2">H2</option>
      <option value="h3">H3</option>
    </select>

    <button onclick="cmd('bold')"><b>B</b></button>
    <button onclick="cmd('insertUnorderedList')">â€¢</button>
    <button onclick="cmd('justifyLeft')">â‰¡</button>
    <button onclick="cmd('undo')">â†¶</button>

    <button onclick="pickImage()">ðŸ–¼</button>
    <input type="file" id="imgPick" accept="image/*" hidden>
  </div>

  <div id="editor" class="editor" contenteditable></div>
  <textarea id="html" class="html"></textarea>

  <div class="footer">
    <select id="visibility">
      <option value="public">Public</option>
      <option value="password">Password</option>
    </select>
    <input id="pass" placeholder="Password" style="display:none">
    <button class="publish" onclick="publish()">Publish</button>
  </div>
</div>

<div class="section">
  <h3>Hasil Link</h3>
  <div id="links"></div>
</div>

<div class="section">
  <h3>History</h3>
  <div id="history"></div>
</div>

<script>
const titleEl=document.getElementById('title');
titleEl.addEventListener('input',()=>{titleEl.style.height='auto';titleEl.style.height=titleEl.scrollHeight+'px'});

let notes=JSON.parse(localStorage.getItem('notes')||'[]');

function idGen(){
  return Math.random().toString(36).substring(2,7);
}
function cmd(c,v=null){document.execCommand(c,false,v)}

function showHTML(){
  html.value=editor.innerHTML;
  editor.style.display='none';
  html.style.display='block';
  setTab(1);
}
function showEditor(){
  editor.innerHTML=html.value;
  html.style.display='none';
  editor.style.display='block';
  setTab(0);
}
function setTab(i){
  document.querySelectorAll('.tab').forEach((t,n)=>t.classList.toggle('active',n===i));
}

visibility.onchange=()=>pass.style.display=visibility.value==='password'?'block':'none';

function pickImage(){imgPick.click()}
imgPick.onchange=e=>{
  const file=e.target.files[0];
  if(!file)return;
  const r=new FileReader();
  r.onload=()=>document.execCommand('insertImage',false,r.result);
  r.readAsDataURL(file);
}

function publish(){
  const id=idGen();
  notes.unshift({
    id,
    title:titleEl.value||'Untitled',
    content:editor.innerHTML,
    time:new Date().toLocaleString(),
    password:visibility.value==='password'?pass.value:''
  });
  localStorage.setItem('notes',JSON.stringify(notes));
  render();
}

function copy(text){navigator.clipboard.writeText(text)}

function render(){
  links.innerHTML='';
  history.innerHTML='';
  notes.forEach(n=>{
    const url=`v/view.html?id=${n.id}`;
    links.innerHTML+=`
      <div class="card">
        <small>${url}</small>
        <button onclick="copy('${url}')">Salin</button>
      </div>`;
    history.innerHTML+=`
      <div class="card">
        <div>
          <b>${n.title}</b><br><small>${n.time}</small>
        </div>
        <div class="actions">
          <button onclick="open('${url}')">Lihat</button>
          <button onclick="copy('${url}')">Salin</button>
          <button onclick="del('${n.id}')">Hapus</button>
        </div>
      </div>`;
  });
}
function del(id){
  notes=notes.filter(n=>n.id!==id);
  localStorage.setItem('notes',JSON.stringify(notes));
  render();
}
render();
</script>
</body>
</html>
