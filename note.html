<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Note</title>

<style>
*{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto}
body{margin:0;background:#f5f5f5;color:#111}
.container{max-width:700px;margin:auto;padding:12px}

.title-input{
  width:100%;
  padding:10px 12px;
  font-size:16px;
  border:1px solid #ddd;
  border-radius:8px;
  margin-bottom:10px;
}

.toolbar{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  margin-bottom:6px;
}
.toolbar button{
  width:36px;
  height:36px;
  border:1px solid #ddd;
  background:#fff;
  border-radius:6px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.toolbar svg{
  width:18px;
  height:18px;
  stroke:#111;
  fill:none;
  stroke-width:1.8;
}

.editor{
  min-height:220px;
  border:2px solid #4a90e2;
  border-radius:10px;
  padding:10px;
  background:#fff;
  overflow:auto;
}
.editor img{
  max-width:100%;
  height:auto;
  display:block;
  margin:8px auto;
  border-radius:6px;
}

.actions{
  display:flex;
  gap:8px;
  margin-top:10px;
}
select,button.publish{
  padding:8px 12px;
  border-radius:8px;
  border:1px solid #ddd;
}
button.publish{
  background:#e53935;
  color:#fff;
  border:none;
}

.section{margin-top:18px}
.card{
  background:#fff;
  border-radius:8px;
  padding:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:6px;
  gap:10px;
}
.card span{font-size:13px;word-break:break-all}
.card button{
  padding:6px 10px;
  border-radius:6px;
  border:1px solid #ddd;
  background:#fafafa;
}
</style>
</head>

<body>
<div class="container">

<input id="title" class="title-input" placeholder="Title">

<div class="toolbar">
  <button onclick="cmd('bold')">
    <svg viewBox="0 0 24 24"><path d="M7 4h6a4 4 0 010 8H7z"/><path d="M7 12h7a4 4 0 010 8H7z"/></svg>
  </button>

  <button onclick="cmd('italic')">
    <svg viewBox="0 0 24 24"><line x1="19" y1="4" x2="10" y2="4"/><line x1="14" y1="20" x2="5" y2="20"/><line x1="15" y1="4" x2="9" y2="20"/></svg>
  </button>

  <button onclick="cmd('underline')">
    <svg viewBox="0 0 24 24"><path d="M6 4v6a6 6 0 0012 0V4"/><line x1="4" y1="20" x2="20" y2="20"/></svg>
  </button>

  <button onclick="insertImage()">
    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="9" cy="9" r="2"/><path d="M21 17l-5-5-4 4-2-2-5 5"/></svg>
  </button>
</div>

<div id="editor" class="editor" contenteditable></div>

<div class="actions">
  <select id="visibility">
    <option value="public">Public</option>
    <option value="password">Password</option>
  </select>
  <button class="publish" onclick="publish()">Publish</button>
</div>

<div class="section">
  <h3>Hasil Link</h3>
  <div id="links"></div>
</div>

<div class="section">
  <h3>History</h3>
  <div id="history"></div>
</div>

</div>

<input type="file" id="imgPicker" accept="image/*" hidden>

<script>
const editor = document.getElementById("editor");
const imgPicker = document.getElementById("imgPicker");
const links = document.getElementById("links");
const historyBox = document.getElementById("history");

let notes = JSON.parse(localStorage.getItem("notes")||"[]");

function cmd(c){document.execCommand(c,false,null);}

function insertImage(){
  imgPicker.click();
}

imgPicker.onchange=e=>{
  const f=e.target.files[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=()=>{
    document.execCommand("insertImage",false,r.result);
  }
  r.readAsDataURL(f);
}

function genID(){
  return Math.random().toString(36).slice(2,7);
}

function publish(){
  let pass="";
  if(visibility.value==="password"){
    pass=prompt("Masukkan password");
  }

  const note={
    id:genID(),
    title:title.value||"(No Title)",
    content:editor.innerHTML,
    time:new Date().toLocaleString(),
    password:pass
  };

  notes.unshift(note);
  localStorage.setItem("notes",JSON.stringify(notes));
  render();
}

function render(){
  links.innerHTML="";
  historyBox.innerHTML="";

  notes.forEach((n,i)=>{
    const url=`v/view.html?id=${n.id}`;

    if(i===0){
      links.innerHTML=`
        <div class="card">
          <span>${url}</span>
          <button onclick="copy('${url}')">Salin</button>
        </div>`;
    }

    historyBox.innerHTML+=`
      <div class="card">
        <div>
          <b>${n.title}</b><br>
          <small>${n.time}</small>
        </div>
        <button onclick="openLink('${url}')">Buka</button>
      </div>`;
  });
}

function copy(t){
  navigator.clipboard.writeText(t);
}

function openLink(u){
  window.open(u,"_blank");
}

render();
</script>
</body>
</html>
